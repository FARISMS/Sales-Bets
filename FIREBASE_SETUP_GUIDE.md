# Firebase Setup Guide for Sales Bets App

## Prerequisites
- Flutter SDK installed
- Android Studio / Xcode for platform-specific setup
- Firebase CLI (optional but recommended)

## Step 1: Create Firebase Project

1. Go to [Firebase Console](https://console.firebase.google.com/)
2. Click "Add project"
3. Enter project name: "Sales Bets App"
4. Enable Google Analytics (optional)
5. Create project

## Step 2: Add Android App

1. In Firebase Console, click "Add app" → Android
2. Enter package name: `com.example.sales_bets`
3. Download `google-services.json`
4. Place it in `android/app/` directory

### Android Configuration

Update `android/build.gradle`:
```gradle
buildscript {
    dependencies {
        classpath 'com.google.gms:google-services:4.4.2'
    }
}
```

Update `android/app/build.gradle`:
```gradle
plugins {
    id 'com.google.gms.google-services'
}

dependencies {
    implementation platform('com.google.firebase:firebase-bom:33.7.0')
    implementation 'com.google.firebase:firebase-analytics'
    implementation 'com.google.firebase:firebase-auth'
    implementation 'com.google.firebase:firebase-firestore'
    implementation 'com.google.firebase:firebase-messaging'
}
```

## Step 3: Add iOS App

1. In Firebase Console, click "Add app" → iOS
2. Enter bundle ID: `com.example.salesBets`
3. Download `GoogleService-Info.plist`
4. Add to Xcode project in `ios/Runner/`

### iOS Configuration

Update `ios/Podfile`:
```ruby
pod 'Firebase/Analytics'
pod 'Firebase/Auth'
pod 'Firebase/Firestore'
pod 'Firebase/Messaging'
```

Update `ios/Runner/AppDelegate.swift`:
```swift
import UIKit
import Flutter
import FirebaseCore

@UIApplicationMain
@objc class AppDelegate: FlutterAppDelegate {
  override func application(
    _ application: UIApplication,
    didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: Any]?
  ) -> Bool {
    FirebaseApp.configure()
    GeneratedPluginRegistrant.register(with: self)
    return super.application(application, didFinishLaunchingWithOptions: launchOptions)
  }
}
```

## Step 4: Enable Firebase Services

### Authentication
1. Go to Authentication → Sign-in method
2. Enable Email/Password
3. Optionally enable Google, Apple, etc.

### Firestore Database
1. Go to Firestore Database
2. Create database in production mode
3. Set up security rules (see below)

### Cloud Messaging
1. FCM is automatically enabled
2. Configure APNs for iOS (if needed)

## Step 5: Security Rules

### Firestore Rules
```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Users can only access their own data
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // Bets: users can create/read their own bets
    match /bets/{betId} {
      allow create: if request.auth != null && request.resource.data.userId == request.auth.uid;
      allow read: if request.auth != null && (resource.data.userId == request.auth.uid || request.auth.uid in resource.data.participants);
      allow update: if request.auth != null && request.auth.uid == resource.data.userId;
    }
    
    // Challenges: publicly readable, admin writable
    match /challenges/{challengeId} {
      allow read: if true;
      allow write: if false; // Admin only - implement custom claims
    }
    
    // Teams: publicly readable, admin writable
    match /teams/{teamId} {
      allow read: if true;
      allow write: if false; // Admin only
    }
    
    // Chat messages: users can read/write for streams they're part of
    match /chatMessages/{messageId} {
      allow read, write: if request.auth != null;
    }
    
    // Live streams: publicly readable
    match /liveStreams/{streamId} {
      allow read: if true;
      allow write: if false; // Admin only
    }
  }
}
```

## Step 6: Environment Configuration

Create `lib/core/config/firebase_options.dart` (auto-generated):
```dart
// File generated by FlutterFire CLI.
// ignore_for_file: lines_longer_than_80_chars, avoid_classes_with_only_static_members
import 'package:firebase_core/firebase_core.dart' show FirebaseOptions;
import 'package:flutter/foundation.dart'
    show defaultTargetPlatform, kIsWeb, TargetPlatform;

class DefaultFirebaseOptions {
  static FirebaseOptions get currentPlatform {
    if (kIsWeb) {
      return web;
    }
    switch (defaultTargetPlatform) {
      case TargetPlatform.android:
        return android;
      case TargetPlatform.iOS:
        return ios;
      case TargetPlatform.macOS:
        return macos;
      case TargetPlatform.windows:
        throw UnsupportedError(
          'DefaultFirebaseOptions have not been configured for windows - '
          'you can reconfigure this by running the FlutterFire CLI again.',
        );
      case TargetPlatform.linux:
        throw UnsupportedError(
          'DefaultFirebaseOptions have not been configured for linux - '
          'you can reconfigure this by running the FlutterFire CLI again.',
        );
      default:
        throw UnsupportedError(
          'DefaultFirebaseOptions are not supported for this platform.',
        );
    }
  }

  static const FirebaseOptions web = FirebaseOptions(
    apiKey: 'your-web-api-key',
    appId: 'your-web-app-id',
    messagingSenderId: 'your-sender-id',
    projectId: 'your-project-id',
    authDomain: 'your-project-id.firebaseapp.com',
    storageBucket: 'your-project-id.appspot.com',
  );

  static const FirebaseOptions android = FirebaseOptions(
    apiKey: 'your-android-api-key',
    appId: 'your-android-app-id',
    messagingSenderId: 'your-sender-id',
    projectId: 'your-project-id',
    storageBucket: 'your-project-id.appspot.com',
  );

  static const FirebaseOptions ios = FirebaseOptions(
    apiKey: 'your-ios-api-key',
    appId: 'your-ios-app-id',
    messagingSenderId: 'your-sender-id',
    projectId: 'your-project-id',
    storageBucket: 'your-project-id.appspot.com',
    iosBundleId: 'com.example.salesBets',
  );

  static const FirebaseOptions macos = FirebaseOptions(
    apiKey: 'your-macos-api-key',
    appId: 'your-macos-app-id',
    messagingSenderId: 'your-sender-id',
    projectId: 'your-project-id',
    storageBucket: 'your-project-id.appspot.com',
    iosBundleId: 'com.example.salesBets',
  );
}
```

## Step 7: Flutter Dependencies

Update `pubspec.yaml`:
```yaml
dependencies:
  firebase_core: ^3.6.0
  firebase_auth: ^5.3.1
  cloud_firestore: ^5.4.3
  firebase_messaging: ^15.1.3
  firebase_analytics: ^11.3.3
```

## Step 8: Initialize Firebase

Update `lib/main.dart`:
```dart
import 'package:firebase_core/firebase_core.dart';
import 'firebase_options.dart';

void main() async {
  WidgetsFlutterBinding.ensureInitialized();
  await Firebase.initializeApp(
    options: DefaultFirebaseOptions.currentPlatform,
  );
  runApp(MyApp());
}
```

## Testing

1. Run `flutter clean && flutter pub get`
2. Test authentication flow
3. Test Firestore read/write operations
4. Test push notifications

## Troubleshooting

### Common Issues:
1. **Build errors**: Ensure all platform-specific files are in place
2. **Authentication errors**: Check security rules and API keys
3. **Firestore errors**: Verify database rules and network connectivity
4. **FCM errors**: Check APNs configuration for iOS

### Debug Commands:
```bash
flutter doctor
flutter clean
flutter pub get
flutter run --verbose
```

## Security Best Practices

1. Never commit API keys to version control
2. Use environment variables for sensitive data
3. Implement proper security rules
4. Use Firebase App Check for additional security
5. Regularly audit user permissions

## Next Steps

After setup:
1. Implement authentication flows
2. Set up real-time data listeners
3. Configure push notifications
4. Add error handling and offline support
5. Implement user management features
